# ================================================================================
# ConfigMap - Configuration de l'application CodeArena
# ================================================================================
# Stocke les variables de configuration non-sensibles
# Ces valeurs sont injectées dans les pods comme variables d'environnement
# ================================================================================

apiVersion: v1
kind: ConfigMap
metadata:
  name: codearena-config
  namespace: codearena
  labels:
    app: codearena
    component: config
data:
  # Configuration Frontend
  VITE_API_URL: "http://codearena-backend:3000/api"
  VITE_WS_URL: "ws://codearena-backend:3000"

  # Configuration Backend
  NODE_ENV: "production"
  PORT: "3000"
  API_VERSION: "v1"

  # Configuration Sandbox
  EXECUTION_TIMEOUT: "5"
  MEMORY_LIMIT: "256M"
  MAX_CONCURRENT_EXECUTIONS: "10"

  # Configuration Redis
  REDIS_HOST: "redis-service"
  REDIS_PORT: "6379"
  REDIS_DB: "0"

  # Configuration générale
  LOG_LEVEL: "info"
  CORS_ORIGIN: "*"

---
# ================================================================================
# ConfigMap - Configuration Nginx pour le Frontend
# ================================================================================

apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
  namespace: codearena
  labels:
    app: codearena
    component: frontend
data:
  default.conf: |
    server {
        listen 80;
        server_name localhost;
        root /usr/share/nginx/html;
        index index.html;

        # Compression Gzip
        gzip on;
        gzip_vary on;
        gzip_min_length 1024;
        gzip_types text/plain text/css text/xml text/javascript
                   application/x-javascript application/xml+rss
                   application/javascript application/json;

        # Cache pour les assets statiques
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }

        # Route principale - Support React Router
        location / {
            try_files $uri $uri/ /index.html;
        }

        # Headers de sécurité
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-XSS-Protection "1; mode=block" always;

        server_tokens off;
    }
